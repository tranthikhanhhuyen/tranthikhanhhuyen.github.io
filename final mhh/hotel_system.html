<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Imperial Palace | Luxury Hotel Automation System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Montserrat:wght@300;400;500;600&family=Fira+Code:wght@300;400&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        :root {
            --primary-gold: #c5a059;
            --primary-dark: #0f172a;
            --text-light: #f8fafc;
            --text-gray: #94a3b8;
            --bg-light: #ffffff;
            --bg-off-white: #f9f9f9;
            --glass-bg: rgba(15, 23, 42, 0.85);
            --glass-border: 1px solid rgba(255, 255, 255, 0.1);
            --shadow-lg: 0 20px 25px -5px rgba(179, 155, 155, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            --transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            --accent-green: #10b981;
            --accent-red: #ef4444;
            --accent-blue: #3b82f6;
            --accent-orange: #f59e0b;
            --cyber-green: #00ff41;
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            scroll-behavior: smooth;
        }
        body {
            font-family: 'Montserrat', sans-serif;
            color: var(--primary-dark);
            background-color: var(--bg-off-white);
            overflow-x: hidden;
        }
        h1, h2, h3, h4, h5 {
            font-family: 'Playfair Display', serif;
        }
        a {
            text-decoration: none;
            color: inherit;
            transition: var(--transition);
        }
        ul {
            list-style: none;
        }
        .hidden {
            display: none !important;
        }
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: var(--primary-gold);
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #b08d45;
        }
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .toast-item {
            background: var(--glass-bg);
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            border-left: 4px solid var(--primary-gold);
            box-shadow: var(--shadow-lg);
            backdrop-filter: blur(10px);
            animation: slideInRight 0.4s ease;
            min-width: 280px;
        }
        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        .navbar {
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 5%;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(15px);
            border-bottom: var(--glass-border);
            transition: var(--transition);
        }
        .navbar.scrolled {
            background: var(--primary-dark);
            padding: 15px 5%;
            box-shadow: var(--shadow-lg);
        }
        .logo {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--text-light);
            letter-spacing: 2px;
        }
        .logo span {
            color: var(--primary-gold);
        }
        .nav-menu {
            display: flex;
            gap: 30px;
        }
        .nav-link {
            color: var(--text-light);
            font-size: 0.9rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
        }
        .nav-link::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 0;
            height: 2px;
            background: var(--primary-gold);
            transition: var(--transition);
        }
        .nav-link:hover::after {
            width: 100%;
        }
        .nav-link:hover {
            color: var(--primary-gold);
        }
        .nav-actions {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        .btn-login-user {
            background: none;
            border: 1px solid white;
            color: white;
            padding: 8px 20px;
            border-radius: 30px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.8rem;
            transition: 0.3s;
        }
        .btn-login-user:hover {
            background: white;
            color: var(--primary-dark);
        }
        .user-profile-badge {
            display: flex;
            align-items: center;
            gap: 10px;
            color: white;
            cursor: pointer;
            padding: 5px 15px;
            border-radius: 30px;
            background: rgba(255,255,255,0.1);
            border: 1px solid var(--primary-gold);
        }
        .user-profile-badge:hover {
            background: rgba(255,255,255,0.2);
        }
        .user-avatar {
            width: 30px;
            height: 30px;
            background: var(--primary-gold);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.8rem;
            color: var(--primary-dark);
        }
        .btn-portal {
            padding: 10px 25px;
            border: 1px solid var(--primary-gold);
            color: var(--primary-gold);
            border-radius: 30px;
            font-weight: 600;
            font-size: 0.8rem;
            letter-spacing: 1px;
            transition: var(--transition);
            background: transparent;
            cursor: pointer;
        }
        .btn-portal:hover {
            background: var(--primary-gold);
            color: white;
            box-shadow: 0 0 15px rgba(197, 160, 89, 0.5);
        }
        .auth-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(15, 23, 42, 0.98);
            z-index: 9000;
            display: none;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(10px);
        }
        .auth-overlay.active {
            display: flex;
        }
        .auth-card {
            background: white;
            padding: 50px;
            border-radius: 5px;
            width: 100%;
            max-width: 450px;
            text-align: center;
            box-shadow: var(--shadow-lg);
            animation: fadeInUp 0.6s ease;
        }
        .auth-card h2 {
            font-size: 2rem;
            margin-bottom: 10px;
            color: var(--primary-dark);
        }
        .auth-card p {
            color: var(--text-gray);
            margin-bottom: 30px;
            font-size: 0.9rem;
        }
        .pin-container {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 30px;
        }
        .pin-digit {
            width: 50px;
            height: 60px;
            border: 2px solid #e2e8f0;
            font-size: 1.5rem;
            text-align: center;
            font-weight: 700;
            outline: none;
            transition: 0.3s;
        }
        .pin-digit:focus {
            border-color: var(--primary-gold);
            box-shadow: 0 0 10px rgba(197, 160, 89, 0.3);
        }
        .hero {
            height: 100vh;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            background: url('https://images.unsplash.com/photo-1542314831-068cd1dbfeeb?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80') center/cover no-repeat fixed;
            color: white;
            text-align: center;
        }
        .hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, rgba(0,0,0,0.4), rgba(0,0,0,0.7));
        }
        .hero-content {
            position: relative;
            z-index: 10;
            animation: fadeInUp 1.2s ease-out;
        }
        .hero-subtitle {
            font-size: 1.2rem;
            letter-spacing: 5px;
            text-transform: uppercase;
            margin-bottom: 20px;
            display: block;
            color: var(--primary-gold);
        }
        .hero-title {
            font-size: 4.5rem;
            margin-bottom: 30px;
            line-height: 1.1;
        }
        .hero-desc {
            font-size: 1.1rem;
            max-width: 600px;
            margin: 0 auto 40px;
            color: rgba(255,255,255,0.8);
        }
        .btn-primary {
            background: var(--primary-gold);
            color: white;
            padding: 15px 40px;
            border: none;
            font-size: 1rem;
            letter-spacing: 2px;
            text-transform: uppercase;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            font-weight: 600;
        }
        .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            transition: 0.5s;
        }
        .btn-primary:hover::before {
            left: 100%;
        }
        .btn-primary:hover {
            background: #b08d45;
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
        }
        .booking-engine {
            position: relative;
            margin-top: -80px;
            z-index: 20;
            padding: 0 5%;
        }
        .search-bar {
            background: white;
            padding: 40px;
            border-radius: 5px;
            box-shadow: var(--shadow-lg);
            display: flex;
            gap: 20px;
            align-items: flex-end;
            flex-wrap: wrap;
        }
        .input-group {
            flex: 1;
            min-width: 200px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .input-group label {
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--primary-dark);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .input-group input, .input-group select {
            padding: 15px;
            border: 1px solid #e2e8f0;
            border-radius: 0;
            font-family: 'Montserrat', sans-serif;
            transition: 0.3s;
        }
        .input-group input:focus {
            border-color: var(--primary-gold);
            outline: none;
        }
        .search-btn {
            background: var(--primary-dark);
            color: white;
            padding: 15px 30px;
            border: none;
            cursor: pointer;
            text-transform: uppercase;
            font-weight: 600;
            letter-spacing: 1px;
            height: 50px;
        }
        .search-btn:hover {
            background: var(--primary-gold);
        }
        .section-padding {
            padding: 100px 5%;
        }
        .section-header {
            text-align: center;
            margin-bottom: 60px;
        }
        .section-header span {
            color: var(--primary-gold);
            font-weight: 600;
            letter-spacing: 3px;
            text-transform: uppercase;
            display: block;
            margin-bottom: 10px;
        }
        .section-header h2 {
            font-size: 3rem;
            color: var(--primary-dark);
        }
        .room-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 40px;
        }
        .room-card {
            background: white;
            border: 1px solid #f0f0f0;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }
        .room-card:hover {
            transform: translateY(-15px);
            box-shadow: var(--shadow-lg);
            border-color: transparent;
        }
        .room-img-box {
            height: 280px;
            overflow: hidden;
            position: relative;
            background-color: #f1f1f1;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .room-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.8s ease;
        }
        .room-card:hover .room-img {
            transform: scale(1.1);
        }
        .status-badge {
            position: absolute;
            top: 20px;
            left: 20px;
            padding: 8px 15px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: white;
            z-index: 5;
        }
        .bg-avail { background-color: #10b981; }
        .bg-booked { background-color: #ef4444; }
        .bg-maint { background-color: #64748b; }
        .bg-cleaning { background-color: #f59e0b; }
        .price-badge {
            position: absolute;
            bottom: 0;
            right: 0;
            background: var(--primary-gold);
            color: white;
            padding: 10px 25px;
            font-family: 'Playfair Display';
            font-size: 1.2rem;
            font-weight: 700;
        }
        .room-details {
            padding: 30px;
        }
        .room-type {
            color: var(--primary-gold);
            font-size: 0.8rem;
            letter-spacing: 2px;
            text-transform: uppercase;
            font-weight: 600;
        }
        .room-title {
            font-size: 1.8rem;
            margin: 10px 0;
            color: var(--primary-dark);
        }
        .room-amenities {
            display: flex;
            gap: 15px;
            color: var(--text-gray);
            margin-bottom: 25px;
            font-size: 0.9rem;
        }
        .room-amenities i {
            color: var(--primary-gold);
        }
        .btn-book {
            width: 100%;
            padding: 15px;
            border: 1px solid var(--primary-dark);
            background: transparent;
            color: var(--primary-dark);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            transition: 0.3s;
        }
        .btn-book:hover:not(:disabled) {
            background: var(--primary-dark);
            color: white;
        }
        .btn-book:disabled {
            border-color: #cbd5e1;
            color: #cbd5e1;
            cursor: not-allowed;
        }
        .services-section {
            background: var(--primary-dark);
            color: white;
            text-align: center;
        }
        .services-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 30px;
            margin-top: 50px;
        }
        .service-item i {
            font-size: 3rem;
            color: var(--primary-gold);
            margin-bottom: 20px;
        }
        .service-item h4 {
            margin-bottom: 10px;
            font-size: 1.2rem;
        }
        .service-item p {
            color: #94a3b8;
            font-size: 0.9rem;
            line-height: 1.6;
        }
        footer {
            background: #0b1120;
            padding: 80px 5% 30px;
            color: #94a3b8;
        }
        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 40px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding-bottom: 50px;
        }
        .footer-brand h2 {
            color: white;
            margin-bottom: 20px;
            font-size: 2rem;
        }
        .footer-brand span {
            color: var(--primary-gold);
        }
        .footer-col h4 {
            color: white;
            margin-bottom: 25px;
            font-size: 1.1rem;
            letter-spacing: 1px;
            text-transform: uppercase;
        }
        .footer-col ul li {
            margin-bottom: 15px;
            transition: 0.3s;
            cursor: pointer;
        }
        .footer-col ul li:hover {
            color: var(--primary-gold);
            padding-left: 5px;
        }
        .copyright {
            text-align: center;
            margin-top: 30px;
            font-size: 0.8rem;
        }
        #admin-interface {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: #0b0f1a;
            z-index: 2000;
            color: #e2e8f0;
            display: grid;
            grid-template-columns: 280px 1fr;
        }
        .sidebar {
            background: #111827;
            border-right: 1px solid #1f2937;
            padding: 40px 20px;
            display: flex;
            flex-direction: column;
        }
        .admin-logo {
            font-family: 'Playfair Display';
            font-size: 1.8rem;
            color: white;
            margin-bottom: 60px;
            text-align: left;
            padding-left: 10px;
        }
        .admin-logo span {
            color: var(--primary-gold);
            display: block;
            font-size: 0.7rem;
            font-family: 'Montserrat';
            letter-spacing: 2px;
        }
        .menu-item {
            padding: 16px 20px;
            margin-bottom: 8px;
            border-radius: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 15px;
            color: #9ca3af;
            transition: 0.3s;
            font-size: 0.9rem;
            font-weight: 500;
        }
        .menu-item:hover, .menu-item.active {
            background: #1f2937;
            color: white;
        }
        .menu-item.active {
            background: #1f2937;
            color: var(--primary-gold);
            border-left: 4px solid var(--primary-gold);
            border-radius: 0 12px 12px 0;
        }
        .menu-item i {
            width: 20px;
            font-size: 1.1rem;
        }
        .dashboard-main {
            padding: 40px;
            overflow-y: auto;
            background: radial-gradient(circle at top right, #111827, #0b0f1a);
        }
        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
            flex-wrap: wrap;
            gap: 20px;
        }
        .admin-header h2 {
            font-size: 2.2rem;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 24px;
            margin-bottom: 40px;
        }
        .stat-box {
            background: rgba(31, 41, 55, 0.5);
            padding: 30px;
            border-radius: 20px;
            border: 1px solid rgba(255,255,255,0.05);
            backdrop-filter: blur(10px);
            transition: transform 0.3s, border-color 0.3s;
        }
        .stat-box:hover {
            transform: translateY(-5px);
            border-color: var(--primary-gold);
        }
        .stat-box .label {
            color: #9ca3af;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 15px;
            display: block;
        }
        .stat-box .value {
            font-size: 2rem;
            font-weight: 700;
            color: white;
            margin-bottom: 10px;
        }
        .matrix-container {
            background: rgba(31, 41, 55, 0.5);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(255,255,255,0.05);
            margin-bottom: 30px;
            overflow-x: auto;
        }
        .matrix-table {
            width: 100%;
            min-width: 1000px;
            border-collapse: separate;
            border-spacing: 0 10px;
        }
        .matrix-table th {
            color: #9ca3af;
            font-weight: 500;
            padding: 15px;
            font-size: 0.75rem;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        .matrix-table td {
            padding: 15px;
            text-align: center;
            vertical-align: middle;
            border-bottom: 1px solid rgba(255,255,255,0.02);
        }
        .status-slot {
            width: auto;
            min-width: 80px;
            padding: 0 10px;
            height: 35px;
            border-radius: 8px;
            font-size: 0.7rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: 0.3s;
            cursor: help;
            white-space: nowrap;
        }
        .slot-open { background: rgba(16, 185, 129, 0.1); color: #10b981; border: 1px solid rgba(16, 185, 129, 0.2); }
        .slot-booked { background: rgba(239, 68, 68, 0.1); color: #ef4444; border: 1px solid rgba(239, 68, 68, 0.2); }
        .slot-ai { background: rgba(59, 130, 246, 0.1); color: #3b82f6; border: 1px solid rgba(59, 130, 246, 0.2); }
        .slot-maint { background: rgba(100, 116, 139, 0.1); color: #64748b; border: 1px solid rgba(100, 116, 139, 0.2); }
        .slot-cleaning { background: rgba(245, 158, 11, 0.1); color: #f59e0b; border: 1px solid rgba(245, 158, 11, 0.2); }
        .automation-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 24px;
        }
        .engine-card {
            background: rgba(31, 41, 55, 0.5);
            padding: 30px;
            border-radius: 20px;
            border: 1px solid rgba(255,255,255,0.05);
            display: flex;
            flex-direction: column;
            gap: 20px;
            transition: 0.3s;
        }
        .engine-card:hover {
            border-color: var(--primary-gold);
            transform: translateY(-5px);
        }
        .engine-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .engine-config {
            display: flex;
            flex-direction: column;
            gap: 10px;
            padding-top: 15px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }
        .config-row {
            display: flex;
            justify-content: space-between;
            font-size: 0.75rem;
            color: #9ca3af;
        }
        .config-val {
            color: var(--primary-gold);
            font-weight: 600;
        }
        .engine-slider {
            width: 100%;
            accent-color: var(--primary-gold);
            cursor: pointer;
            height: 4px;
        }
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 26px;
        }
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #374151;
            transition: .4s;
            border-radius: 34px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider {
            background-color: var(--primary-gold);
        }
        input:checked + .slider:before {
            transform: translateX(24px);
        }
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(15, 23, 42, 0.9);
            z-index: 5000;
            display: none;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(8px);
        }
        .modal-overlay.active {
            display: flex;
        }
        .modal-box {
            background: white;
            width: 95%;
            max-width: 650px;
            padding: 40px;
            border-radius: 0;
            box-shadow: var(--shadow-lg);
            animation: fadeInUp 0.5s ease;
            overflow-y: auto;
            max-height: 90vh;
        }
        .form-label {
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            color: var(--primary-dark);
            margin-bottom: 8px;
            display: block;
        }
        .form-control {
            width: 100%;
            padding: 12px;
            border: 1px solid #e2e8f0;
            outline: none;
            margin-bottom: 15px;
            font-family: inherit;
            transition: 0.3s;
        }
        .form-control:focus {
            border-color: var(--primary-gold);
        }
        .form-control.invalid {
            border-color: var(--accent-red);
            background: #fff5f5;
        }
        .bill-summary {
            background: #f8fafc;
            padding: 25px;
            border-left: 5px solid var(--primary-gold);
            margin-bottom: 25px;
        }
        .bill-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }
        .bill-total {
            font-size: 1.6rem;
            font-weight: 700;
            border-top: 1px solid #e2e8f0;
            padding-top: 15px;
            margin-top: 15px;
            color: var(--primary-dark);
        }
        .payment-box {
            border-top: 1px solid #e2e8f0;
            padding-top: 30px;
        }
        .card-inputs {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            gap: 10px;
        }
        .proc-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 9999;
            display: none;
            justify-content: center;
            align-items: center;
        }
        .proc-box {
            background: #111827;
            width: 90%;
            max-width: 600px;
            padding: 50px;
            border-radius: 30px;
            text-align: center;
            color: white;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .proc-steps {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
            position: relative;
        }
        .proc-steps::before {
            content: '';
            position: absolute;
            top: 15px;
            left: 0;
            width: 100%;
            height: 2px;
            background: #374151;
            z-index: 1;
        }
        .step-circle {
            width: 32px;
            height: 32px;
            background: #111827;
            border: 2px solid #374151;
            border-radius: 50%;
            position: relative;
            z-index: 2;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            transition: 0.3s;
        }
        .step-circle.active {
            border-color: var(--primary-gold);
            color: var(--primary-gold);
            box-shadow: 0 0 15px rgba(197, 160, 89, 0.5);
        }
        .step-circle.done {
            background: var(--primary-gold);
            border-color: var(--primary-gold);
            color: white;
        }
        .step-label {
            position: absolute;
            top: 40px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.7rem;
            white-space: nowrap;
            color: #9ca3af;
        }
        .proc-status-text {
            margin-top: 80px;
            color: var(--primary-gold);
            font-family: monospace;
            font-size: 0.9rem;
        }
        @media (max-width: 1024px) {
            #admin-interface { grid-template-columns: 80px 1fr; }
            .sidebar .admin-logo span, .sidebar .menu-item span { display: none; }
            .sidebar { padding: 20px 10px; align-items: center; }
            .menu-item { justify-content: center; width: 50px; padding: 15px 0; border-radius: 50%; }
            .admin-logo { margin-bottom: 30px; font-size: 1.2rem; text-align: center; padding-left: 0; }
        }
        @media (max-width: 768px) {
            .navbar { padding: 15px 5%; }
            .nav-menu { display: none; }
            .hero-title { font-size: 2.5rem; }
            .stats-grid { grid-template-columns: 1fr; }
            .automation-grid { grid-template-columns: 1fr; }
            .services-grid { grid-template-columns: repeat(2, 1fr); }
            .sidebar { position: fixed; height: 100vh; z-index: 2500; left: -100px; transition: 0.3s; }
            .sidebar.active { left: 0; }
            .matrix-table { min-width: 800px; }
            .card-inputs { grid-template-columns: 1fr; }
            .hide-sm { display: none; }
        }
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .automation-log {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(0,0,0,0.9);
            color: var(--cyber-green);
            padding: 15px 25px;
            border-radius: 5px;
            font-family: 'Fira Code', monospace;
            font-size: 0.8rem;
            z-index: 5000;
            border: 1px solid var(--cyber-green);
            pointer-events: none;
            opacity: 0;
            transition: 0.3s;
            box-shadow: 0 0 20px rgba(0, 255, 65, 0.2);
            text-transform: uppercase;
        }
        .automation-log.active {
            opacity: 1;
        }
        .iot-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        .iot-card {
            background: #f8fafc;
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid #e2e8f0;
            transition: 0.3s;
        }
        .iot-card:hover {
            border-color: var(--primary-gold);
            transform: translateY(-3px);
        }
        .iot-card i {
            font-size: 1.8rem;
            color: var(--primary-gold);
            margin-bottom: 10px;
        }
        .iot-slider {
            width: 100%;
            margin-top: 10px;
            accent-color: var(--primary-gold);
        }
        .mood-btn {
            background: white;
            border: 1px solid var(--primary-gold);
            color: var(--primary-gold);
            padding: 5px 10px;
            font-size: 0.7rem;
            border-radius: 5px;
            cursor: pointer;
            margin: 2px;
        }
        .mood-btn:hover {
            background: var(--primary-gold);
            color: white;
        }
        .supply-card {
            background: rgba(31, 41, 55, 0.5);
            padding: 20px;
            border-radius: 15px;
            border: 1px solid rgba(255,255,255,0.05);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .supply-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .supply-icon {
            width: 45px;
            height: 45px;
            background: rgba(197, 160, 89, 0.1);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-gold);
            font-size: 1.2rem;
        }
        .supply-stock-bar {
            height: 6px;
            background: #1f2937;
            border-radius: 3px;
            margin-top: 10px;
            overflow: hidden;
            width: 100%;
        }
        .supply-stock-fill {
            height: 100%;
            background: var(--primary-gold);
            transition: 0.3s;
        }
        .supply-status {
            font-size: 0.7rem;
            font-weight: 700;
            padding: 4px 8px;
            border-radius: 4px;
        }
        .status-ok { background: rgba(16, 185, 129, 0.1); color: #10b981; }
        .status-low { background: rgba(245, 158, 11, 0.1); color: #f59e0b; }
        #ekyc-preview-box {
            width: 100%;
            height: 180px;
            background: #f8fafc;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            margin-top: 15px;
            position: relative;
        }
        #ekyc-preview-box img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
        .scan-line {
            position: absolute;
            width: 100%;
            height: 4px;
            background: var(--primary-gold);
            box-shadow: 0 0 15px var(--primary-gold);
            top: 0;
            left: 0;
            animation: scanAnim 3s infinite linear;
            opacity: 0;
        }
        @keyframes scanAnim {
            0% { top: 0; }
            100% { top: 100%; }
        }
    </style>
</head>
<body>
    <div class="toast-container" id="toast-container"></div>
    <div id="admin-pin-gate" class="auth-overlay">
        <div class="auth-card">
            <div style="color: var(--primary-gold); font-size: 3rem; margin-bottom: 20px;"><i class="fas fa-shield-alt"></i></div>
            <h2>ADMIN AUTHENTICATION</h2>
            <p>Please enter your 4-digit security PIN to access the Executive Terminal.</p>
            <div class="pin-container">
                <input type="password" class="pin-digit" maxlength="1" onkeyup="app.pinFocus(this, 0)">
                <input type="password" class="pin-digit" maxlength="1" onkeyup="app.pinFocus(this, 1)">
                <input type="password" class="pin-digit" maxlength="1" onkeyup="app.pinFocus(this, 2)">
                <input type="password" class="pin-digit" maxlength="1" onkeyup="app.pinFocus(this, 3)">
            </div>
            <button class="btn-primary" style="width: 100%" onclick="app.verifyAdmin()">SECURE LOGIN</button>
            <p style="margin-top: 25px; cursor: pointer; text-decoration: underline; font-size: 0.85rem;" onclick="app.closeAdminGate()">Return to Guest View</p>
        </div>
    </div>
    <div id="user-login-gate" class="auth-overlay">
        <div class="auth-card">
            <h2>GUEST LOGIN</h2>
            <p>Welcome back to Imperial Elite. Access your exclusive benefits and rewards.</p>
            <div style="text-align: left">
                <label class="form-label">Email Address</label>
                <input type="email" class="form-control" placeholder="guest@imperialpalace.com" id="login-email">
                <label class="form-label">Secure Password</label>
                <input type="password" class="form-control" placeholder="••••••••" id="login-pass">
            </div>
            <button class="btn-primary" style="width: 100%" onclick="app.verifyUser()">SIGN IN TO DASHBOARD</button>
            <p style="margin-top: 20px; cursor: pointer; text-decoration: underline; font-size: 0.85rem;" onclick="app.closeUserGate()">Back to Home</p>
        </div>
    </div>
    <div class="modal-overlay" id="iot-modal">
        <div class="modal-box" style="max-width: 800px;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                <h3 style="margin:0; letter-spacing: 1px;"><i class="fas fa-microchip"></i> ADVANCED SMART HUB</h3>
                <i class="fas fa-times" onclick="app.closeIotModal()" style="cursor:pointer; font-size:1.4rem; color: var(--text-gray);"></i>
            </div>
            <div style="display: flex; justify-content: space-between; background: var(--bg-off-white); padding: 10px 15px; border-radius: 8px; margin-bottom: 20px; font-size: 0.8rem;">
                <span>RESIDENT: <b id="iot-guest-name">...</b></span>
                <span>NODE: <b id="iot-room-number">...</b></span>
                <span id="iot-conn-status" style="color: var(--accent-green); font-weight: 700;"><i class="fas fa-wifi"></i> CONNECTED</span>
            </div>
            <div class="iot-grid">
                <div class="iot-card">
                    <i class="fas fa-thermometer-half"></i>
                    <h4>Climate</h4>
                    <span id="temp-val">22°C</span>
                    <input type="range" class="iot-slider" min="16" max="30" value="22" oninput="app.updateIoT('HVAC', this.value, 'temp-val', '°C')">
                </div>
                <div class="iot-card">
                    <i class="fas fa-lightbulb"></i>
                    <h4>Lighting</h4>
                    <span id="light-val">80%</span>
                    <input type="range" class="iot-slider" min="0" max="100" value="80" oninput="app.updateIoT('LIGHTS', this.value, 'light-val', '%')">
                    <div style="margin-top: 10px;">
                        <button class="mood-btn" onclick="app.setMood('Cinema')">Cinema</button>
                        <button class="mood-btn" onclick="app.setMood('Sleep')">Sleep</button>
                    </div>
                </div>
                <div class="iot-card">
                    <i class="fas fa-person-booth"></i>
                    <h4>Curtains</h4>
                    <span id="curtain-val">Open</span>
                    <input type="range" class="iot-slider" min="0" max="100" value="100" oninput="app.updateIoT('CURTAINS', this.value, 'curtain-val', '% Opened')">
                </div>
                <div class="iot-card">
                    <i class="fas fa-tv"></i>
                    <h4>Entertainment</h4>
                    <button class="btn-portal" style="width:100%; margin-top:5px; font-size: 0.6rem;" onclick="app.toggleTV()">POWER ON/OFF</button>
                    <input type="range" class="iot-slider" min="0" max="100" value="30" oninput="app.updateIoT('AUDIO', this.value, 'vol-val', ' Vol')">
                    <small id="vol-val">30 Vol</small>
                </div>
                <div class="iot-card">
                    <i class="fas fa-hand-paper"></i>
                    <h4>Privacy</h4>
                    <div style="display:flex; justify-content:center; align-items:center; height: 50px;">
                        <label class="switch"><input type="checkbox" id="dnd-toggle" onchange="app.togglePrivacy(this.checked)"><span class="slider"></span></label>
                    </div>
                    <small>DO NOT DISTURB</small>
                </div>
                <div class="iot-card">
                    <i class="fas fa-concierge-bell"></i>
                    <h4>Service</h4>
                    <button class="btn-portal" style="width:100%; margin-top:5px" onclick="app.requestService('Cleaning')">Request Housekeeping</button>
                    <button class="btn-portal" style="width:100%; margin-top:5px" onclick="app.requestService('Laundry')">Laundry Pick-up</button>
                </div>
            </div>
            <button class="btn-primary" style="width:100%; margin-top:20px" onclick="app.closeIotModal()">SYNC WITH MOBILE KEY</button>
        </div>
    </div>
    <div class="modal-overlay" id="checkin-modal">
        <div class="modal-box">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:25px;">
                <h3 style="margin:0; letter-spacing: 1px;">GUEST SELF CHECK-IN</h3>
                <i class="fas fa-times" onclick="app.closeCheckin()" style="cursor:pointer; font-size:1.4rem; color: var(--text-gray);"></i>
            </div>
            <div style="margin-bottom: 20px;">
                <label class="form-label">Enter Booking Confirmation Code</label>
                <input type="text" class="form-control" id="checkin-code" placeholder="Example: IP-7X9B2">
                <p style="font-size: 0.7rem; color: var(--text-gray); margin-top: 5px;">A unique code is generated per session. Static codes will be rejected.</p>
            </div>
            <label class="form-label">E-KYC Verification (Identity Proof)</label>
            <div style="border: 2px dashed #e2e8f0; padding: 20px; text-align: center; margin-bottom: 20px; border-radius: 8px;">
                <i class="fas fa-id-card" style="font-size: 2rem; color: var(--primary-gold); margin-bottom: 10px;"></i>
                <p style="font-size: 0.8rem; color: var(--text-gray);">Upload Passport / ID Card to Activate Digital Key</p>
                <input type="file" id="ekyc-file-checkin" accept="image/*" style="margin-top: 10px; font-size: 0.7rem;" onchange="app.handleEKycPreview(this)">
                <div id="ekyc-preview-box" class="hidden">
                    <div class="scan-line" id="ekyc-scan-line"></div>
                    <img id="ekyc-img-preview" src="">
                </div>
            </div>
            <button class="btn-primary" style="width: 100%" onclick="app.executeCheckin()">ACTIVATE STAY & KEY</button>
        </div>
    </div>
    <div class="modal-overlay" id="guest-checkout-modal">
        <div class="modal-box">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:25px;">
                <h3 style="margin:0; letter-spacing: 1px;">GUEST SELF CHECK-OUT</h3>
                <i class="fas fa-times" onclick="app.closeCheckout()" style="cursor:pointer; font-size:1.4rem; color: var(--text-gray);"></i>
            </div>
            <div style="margin-bottom: 20px;">
                <label class="form-label">Enter Booking Confirmation Code</label>
                <input type="text" class="form-control" id="checkout-code-guest" placeholder="Example: IP-A2B3C">
                <p style="font-size: 0.7rem; color: var(--text-gray); margin-top: 5px;">Your digital key will be deactivated upon confirmation.</p>
            </div>
            <button class="btn-primary" style="width: 100%; background: var(--accent-red);" onclick="app.executeGuestCheckout()">DEACTIVATE KEY & CHECK-OUT</button>
        </div>
    </div>
    <div id="client-app">
        <nav class="navbar" id="navbar">
            <div class="logo">IMPERIAL <span>PALACE</span></div>
            <ul class="nav-menu">
                <li><a href="#" class="nav-link">Home</a></li>
                <li><a href="#rooms" class="nav-link">Rooms & Suites</a></li>
                <li><a href="#services" class="nav-link">Services</a></li>
                <li><a href="javascript:app.openCheckin()" class="nav-link" style="color: var(--primary-gold); font-weight: 700;">Check-in</a></li>
                <li><a href="javascript:app.openCheckout()" class="nav-link" style="color: var(--accent-red); font-weight: 700;">Check-out</a></li>
            </ul>
            <div class="nav-actions" id="nav-actions-container">
                <button class="btn-login-user" onclick="app.openUserGate()">Guest Login</button>
                <button class="btn-portal" onclick="app.openAdminGate()">Staff Terminal</button>
            </div>
        </nav>
        <header class="hero">
            <div class="hero-content">
                <span class="hero-subtitle">The Pinnacle of Luxury Automation</span>
                <h1 class="hero-title">Experience Timeless<br>Elegance</h1>
                <p class="hero-desc">Experience the most advanced automated booking ecosystem combined with 5-star world-class resort living.</p>
                <button class="btn-primary" onclick="document.getElementById('booking-engine').scrollIntoView()">Explore Our Collection</button>
            </div>
        </header>
        <div class="booking-engine" id="booking-engine">
            <div class="search-bar">
                <div class="input-group">
                    <label>Check-in Date</label>
                    <input type="date" id="search-checkin">
                </div>
                <div class="input-group">
                    <label>Check-out Date</label>
                    <input type="date" id="search-checkout">
                </div>
                <div class="input-group">
                    <label>Collection Type</label>
                    <select id="search-type">
                        <option value="all">All Residences</option>
                        <option value="Deluxe">Deluxe Rooms</option>
                        <option value="Suite">Royal Suites</option>
                        <option value="Villa">Beach Villas</option>
                    </select>
                </div>
                <button class="search-btn" onclick="app.filterRooms()">Find Your Room</button>
            </div>
        </div>
        <section class="section-padding" id="rooms">
            <div class="section-header">
                <span>The Imperial Collection</span>
                <h2>Luxury Accommodation</h2>
            </div>
            <div class="room-grid" id="room-grid"></div>
        </section>
        <section class="section-padding services-section" id="services">
            <div class="section-header">
                <span style="color:var(--primary-gold)">Curated Amenities</span>
                <h2 style="color:white">World-Class Services</h2>
            </div>
            <div class="services-grid">
                <div class="service-item"><i class="fas fa-utensils"></i><h4>Michelin Dining</h4><p>Exquisite dining experiences with world-renowned master chefs.</p></div>
                <div class="service-item"><i class="fas fa-spa"></i><h4>Spa & Wellness</h4><p>Premium therapeutic treatments to rejuvenate your mind and soul.</p></div>
                <div class="service-item"><i class="fas fa-swimmer"></i><h4>Infinity Pool</h4><p>Olympic-sized pool with panoramic views of the ocean horizon.</p></div>
                <div class="service-item"><i class="fas fa-concierge-bell"></i><h4>24/7 Butler</h4><p>Discreet, dedicated service serving your every request.</p></div>
            </div>
        </section>
        <footer>
            <div class="footer-content">
                <div class="footer-brand">
                    <h2>IMPERIAL <span>PALACE</span></h2>
                    <p>Automated Hospitality Management - Advanced Heuristic Logic simulation for real-time inventory management.</p>
                </div>
                <div class="footer-col">
                    <h4>About Us</h4>
                    <ul><li>Our Legacy</li><li>Careers</li><li>Press</li><li>Sustainability</li></ul>
                </div>
                <div class="footer-col">
                    <h4>Support</h4>
                    <ul><li>Concierge</li><li>Privacy Policy</li><li>Membership Terms</li><li>GDS API</li></ul>
                </div>
                <div class="footer-col">
                    <h4>Newsletter</h4>
                    <p style="margin-bottom:15px; font-size:0.9rem">Sign up for exclusive elite offers.</p>
                    <div style="display:flex;">
                        <input type="email" placeholder="Your Email" style="padding:12px; background:#1e293b; border:none; color:white; width:100%">
                        <button style="background:var(--primary-gold); border:none; color:white; padding:0 20px; cursor:pointer"><i class="fas fa-paper-plane"></i></button>
                    </div>
                </div>
            </div>
            <div class="copyright">&copy; 2026 Imperial Palace Hotel System. Designed for Advanced Automation Portfolio.</div>
        </footer>
    </div>
    <div id="admin-interface" class="hidden">
        <aside class="sidebar">
            <div class="admin-logo">IMPERIAL <span class="hide-sm">PALACE</span></div>
            <div class="menu-item active" onclick="app.switchAdminTab('overview', this)"><i class="fas fa-th-large"></i> <span>Executive Overview</span></div>
            <div class="menu-item" onclick="app.switchAdminTab('matrix', this)"><i class="fas fa-calendar-alt"></i> <span>Inventory Matrix</span></div>
            <div class="menu-item" onclick="app.switchAdminTab('engine', this)"><i class="fas fa-microchip"></i> <span>Automation Engine</span></div>
            <div class="menu-item" onclick="app.switchAdminTab('crm', this)"><i class="fas fa-id-card"></i> <span>Guest CRM</span></div>
            <div class="menu-item" onclick="app.switchAdminTab('supplies', this)"><i class="fas fa-boxes"></i> <span>Supply Logistics</span></div>
            <div style="margin-top:auto">
                <div class="menu-item" onclick="app.resetSystem()" style="color:#f59e0b"><i class="fas fa-sync"></i> <span>Reset System</span></div>
                <div class="menu-item" onclick="app.toggleAdmin(false)" style="color:#ef4444"><i class="fas fa-sign-out-alt"></i> <span>Exit Terminal</span></div>
            </div>
        </aside>
        <main class="dashboard-main" id="admin-main-content"></main>
    </div>
    <div class="proc-overlay" id="proc-overlay">
        <div class="proc-box">
            <h2 style="margin-bottom:10px; font-family: 'Playfair Display';">Processing Request</h2>
            <p id="tx-id" style="color:#9ca3af; font-size:0.8rem; letter-spacing: 2px;">SECURE_TX: INITIALIZING...</p>
            <div class="proc-steps">
                <div class="step-circle" id="step-1"><i class="fas fa-credit-card"></i><span class="step-label">Authorization</span></div>
                <div class="step-circle" id="step-2"><i class="fas fa-lock"></i><span class="step-label">Inventory Hold</span></div>
                <div class="step-circle" id="step-3"><i class="fas fa-brain"></i><span class="step-label">Neural Logic</span></div>
                <div class="step-circle" id="step-4"><i class="fas fa-check"></i><span class="step-label">Confirmation</span></div>
            </div>
            <div class="proc-status-text" id="proc-status-text">Encrypting Gateway Data...</div>
        </div>
    </div>
    <div class="modal-overlay" id="booking-modal">
        <div class="modal-box">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:25px;">
                <h3 style="margin:0; letter-spacing: 1px;">SECURE YOUR RESERVATION</h3>
                <i class="fas fa-times" onclick="app.closeModal()" style="cursor:pointer; font-size:1.4rem; color: var(--text-gray);"></i>
            </div>
            <form id="booking-form" onsubmit="event.preventDefault(); app.validateAndConfirm();">
                <input type="hidden" id="modal-room-id">
                <label class="form-label">Guest Personal Information</label>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <input type="text" class="form-control" id="cust-name" required placeholder="Full Legal Name">
                    <input type="tel" class="form-control" id="cust-phone" required placeholder="International Phone Number">
                </div>
                <input type="email" class="form-control" id="cust-email" required placeholder="Primary Email Address (Validation Active)">
                <div class="bill-summary">
                    <div class="bill-row"><span>Unit Accommodation:</span><strong id="bill-room-name" style="color: var(--primary-gold)">...</strong></div>
                    <div class="bill-row"><span>Stay Duration:</span><span><strong id="bill-nights">0</strong> Nights</span></div>
                    <div class="bill-row"><span style="font-weight: 700; color: var(--accent-orange);">Minimum Deposit Required (30%):</span><span id="bill-deposit-amt" style="font-weight: 700; color: var(--accent-orange);">$0</span></div>
                    <div class="bill-total">Full Stay Value: <span id="bill-total" style="color: var(--primary-gold)">$0</span></div>
                    <div id="bill-deposit-note" style="font-size: 0.75rem; color: var(--text-gray); margin-top: 5px; font-weight: 600;">* Authorized 30% deposit mandatory requirements to confirm booking.</div>
                </div>
                <div class="payment-box">
                    <label class="form-label">Secure Credit Card Settlement</label>
                    <div style="position: relative;">
                        <input type="text" class="form-control" id="pay-card" placeholder="16-digit Card Number" maxlength="16" required style="padding-right: 50px;">
                        <i class="fab fa-cc-visa" style="position: absolute; right: 15px; top: 12px; font-size: 1.5rem; color: #1a1f71;"></i>
                    </div>
                    <div class="card-inputs">
                        <input type="text" class="form-control" id="pay-expiry" placeholder="Expiry MM/YY" maxlength="5" required>
                        <input type="password" class="form-control" id="pay-cvc" placeholder="CVC" maxlength="3" required>
                        <div style="display:flex; align-items:center; justify-content:center; gap: 12px; color: var(--primary-gold); font-size: 1.5rem; background: #f8fafc; margin-bottom: 15px; border-radius: 4px;">
                            <i class="fab fa-cc-mastercard"></i>
                            <i class="fab fa-cc-amex"></i>
                            <i class="fab fa-cc-discover"></i>
                        </div>
                    </div>
                </div>
                <button type="submit" id="submit-booking-btn" class="btn-primary" style="width:100%; margin-top: 10px; padding: 20px;">CONFIRM DEPOSIT & BOOK</button>
                <p style="text-align: center; font-size: 0.7rem; color: #94a3b8; margin-top: 15px;"><i class="fas fa-lock"></i> 256-bit AES End-to-End Encryption Active</p>
            </form>
        </div>
    </div>
    <div class="automation-log" id="automation-log">SYSTEM: Neural Matrix Online.</div>
    <script>
        const DEFAULT_STATE = {
            currentUser: null,
            rooms: [
                { id: 101, name: "Grand Deluxe Garden", type: "Deluxe", price: 350, basePrice: 350, status: "available", house: "Clean", revenue: 142000, ADR: 350, occRate: 75, parity: {booking: 355, expedia: 360}, img: "https://images.pexels.com/photos/164595/pexels-photo-164595.jpeg?auto=compress&cs=tinysrgb&w=800", iot: {temp: 22, light: 80, curtain: 100, tv: false, dnd: false} },
                { id: 102, name: "Grand Deluxe Ocean", type: "Deluxe", price: 450, basePrice: 450, status: "booked", house: "Occupied", revenue: 158000, ADR: 450, occRate: 92, parity: {booking: 455, expedia: 465}, img: "https://images.pexels.com/photos/271618/pexels-photo-271618.jpeg?auto=compress&cs=tinysrgb&w=800", guestName: "Alexander Hamilton", bookingId: "IP-INIT-01", iot: {temp: 20, light: 50, curtain: 50, tv: true, dnd: false} },
                { id: 103, name: "Terrace Garden View", type: "Deluxe", price: 380, basePrice: 380, status: "available", house: "Clean", revenue: 131000, ADR: 380, occRate: 65, parity: {booking: 385, expedia: 390}, img: "https://images.pexels.com/photos/262048/pexels-photo-262048.jpeg?auto=compress&cs=tinysrgb&w=800", iot: {temp: 22, light: 80, curtain: 100, tv: false, dnd: false} },
                { id: 104, name: "Sunset Horizon Suite", type: "Deluxe", price: 420, basePrice: 420, status: "available", house: "Dirty", revenue: 112000, ADR: 420, occRate: 55, parity: {booking: 425, expedia: 430}, img: "https://images.pexels.com/photos/210604/pexels-photo-210604.jpeg?auto=compress&cs=tinysrgb&w=800", iot: {temp: 22, light: 80, curtain: 100, tv: false, dnd: false} },
                { id: 105, name: "Magnolia Wing Room", type: "Deluxe", price: 390, basePrice: 390, status: "available", house: "Clean", revenue: 95000, ADR: 390, occRate: 68, parity: {booking: 395, expedia: 405}, img: "https://images.pexels.com/photos/271624/pexels-photo-271624.jpeg?auto=compress&cs=tinysrgb&w=800", iot: {temp: 22, light: 80, curtain: 100, tv: false, dnd: false} },
                { id: 201, name: "Imperial Suite", type: "Suite", price: 800, basePrice: 800, status: "available", house: "Dirty", revenue: 296000, ADR: 800, occRate: 60, parity: {booking: 810, expedia: 820}, img: "https://images.pexels.com/photos/1579253/pexels-photo-1579253.jpeg?auto=compress&cs=tinysrgb&w=800", iot: {temp: 22, light: 80, curtain: 100, tv: false, dnd: false} },
                { id: 202, name: "Royal Suite", type: "Suite", price: 1200, basePrice: 1200, status: "available", house: "Clean", revenue: 344000, ADR: 1200, occRate: 45, parity: {booking: 1220, expedia: 1240}, img: "https://images.pexels.com/photos/1571460/pexels-photo-1571460.jpeg?auto=compress&cs=tinysrgb&w=800", iot: {temp: 22, light: 80, curtain: 100, tv: false, dnd: false} },
                { id: 203, name: "Executive Club Room", type: "Suite", price: 650, basePrice: 650, status: "available", house: "Clean", revenue: 185000, ADR: 650, occRate: 70, parity: {booking: 660, expedia: 670}, img: "https://images.pexels.com/photos/279746/pexels-photo-279746.jpeg?auto=compress&cs=tinysrgb&w=800", iot: {temp: 22, light: 80, curtain: 100, tv: false, dnd: false} },
                { id: 204, name: "Majestic Grand Suite", type: "Suite", price: 950, basePrice: 950, status: "booked", house: "Occupied", revenue: 210000, ADR: 950, occRate: 78, parity: {booking: 960, expedia: 980}, img: "https://images.pexels.com/photos/2506990/pexels-photo-2506990.jpeg?auto=compress&cs=tinysrgb&w=800", guestName: "George Washington", bookingId: "IP-INIT-02", iot: {temp: 18, light: 100, curtain: 0, tv: true, dnd: true} },
                { id: 205, name: "Diplomatic Suite", type: "Suite", price: 1100, basePrice: 1100, status: "available", house: "Dirty", revenue: 230000, ADR: 1100, occRate: 52, parity: {booking: 1110, expedia: 1150}, img: "https://images.pexels.com/photos/1457842/pexels-photo-1457842.jpeg?auto=compress&cs=tinysrgb&w=800", iot: {temp: 22, light: 80, curtain: 100, tv: false, dnd: false} },
                { id: 301, name: "Cliffside Villa", type: "Villa", price: 2500, basePrice: 2500, status: "available", house: "Clean", revenue: 850000, ADR: 2500, occRate: 30, parity: {booking: 2550, expedia: 2600}, img: "https://images.pexels.com/photos/189296/pexels-photo-189296.jpeg?auto=compress&cs=tinysrgb&w=800", iot: {temp: 22, light: 80, curtain: 100, tv: false, dnd: false} },
                { id: 302, name: "Presidential Villa", type: "Villa", price: 3500, basePrice: 3500, status: "booked", house: "Occupied", revenue: 1490000, ADR: 3500, occRate: 20, parity: {booking: 3580, expedia: 3650}, img: "https://images.pexels.com/photos/2467285/pexels-photo-2467285.jpeg?auto=compress&cs=tinysrgb&w=800", guestName: "James Madison", bookingId: "IP-INIT-03", iot: {temp: 24, light: 20, curtain: 20, tv: false, dnd: false} },
                { id: 303, name: "Overwater Bungalow", type: "Villa", price: 2800, basePrice: 2800, status: "available", house: "Clean", revenue: 720000, ADR: 2800, occRate: 35, parity: {booking: 2850, expedia: 2900}, img: "https://images.pexels.com/photos/1287460/pexels-photo-1287460.jpeg?auto=compress&cs=tinysrgb&w=800", iot: {temp: 22, light: 80, curtain: 100, tv: false, dnd: false} },
                { id: 304, name: "Sanctuary Beach Villa", type: "Villa", price: 3200, basePrice: 3200, status: "available", house: "Clean", revenue: 640000, ADR: 3200, occRate: 28, parity: {booking: 3250, expedia: 3300}, img: "https://images.pexels.com/photos/1134176/pexels-photo-1134176.jpeg?auto=compress&cs=tinysrgb&w=800", iot: {temp: 22, light: 80, curtain: 100, tv: false, dnd: false} },
                { id: 305, name: "Royal Ocean Villa", type: "Villa", price: 4500, basePrice: 4500, status: "available", house: "Dirty", revenue: 1200000, ADR: 4500, occRate: 15, parity: {booking: 4550, expedia: 4600}, img: "https://images.pexels.com/photos/261102/pexels-photo-261102.jpeg?auto=compress&cs=tinysrgb&w=800", iot: {temp: 22, light: 80, curtain: 100, tv: false, dnd: false} }
            ],
            logs: [],
            crm: [
                { name: "Alexander Hamilton", email: "alex@hamilton.com", tier: "PLATINUM", spend: 145200, last: "2 days ago", prefs: "High floor, Foam pillows", points: 15400, stays: 12, health: 98 },
                { name: "George Washington", email: "george@imperial.com", tier: "PLATINUM", spend: 289000, last: "1 week ago", prefs: "Security detail, 18°C", points: 32000, stays: 24, health: 95 },
                { name: "Thomas Jefferson", email: "thomas@jeff.com", tier: "SILVER", spend: 12500, last: "1 month ago", prefs: "Quiet room, Library access", points: 2100, stays: 2, health: 80 },
                { name: "John Adams", email: "john@adams.com", tier: "GOLD", spend: 52000, last: "2 months ago", prefs: "Newspaper daily", points: 9200, stays: 7, health: 88 }
            ],
            supplies: [
                { name: "Bamboo Toothbrushes", stock: 450, min: 100, unit: "pcs", cat: "Amenities" },
                { name: "Sandalwood Soap Bars", stock: 320, min: 80, unit: "pcs", cat: "Amenities" },
                { name: "Egyptian Cotton Towels", stock: 85, min: 100, unit: "sets", cat: "Linens" },
                { name: "Single Malt Whiskey (50ml)", stock: 120, min: 50, unit: "btl", Gran: "Minibar" },
                { name: "Luxury Tea Selection", stock: 1200, min: 300, unit: "sachets", cat: "F&B" },
                { name: "Artisanal Water (330ml)", stock: 800, min: 200, unit: "btl", cat: "F&B" }
            ],
            engine: { 
                pricing: true, pricingSens: 85, gap: true, gapThreshold: 2,
                vip: true, vipTier: 'Gold', eco: false, ecoTemp: 24,
                guard: true, guardLimit: 105, predictive: true, predictiveSens: 75,
                concierge: true, conciergeLogic: 90
            },
            totalRevenue: 3758650,
            bufferHoldCount: 0
        };
        let DB = {};
        const app = {
            init: function() {
                this.loadState();
                this.setupDates();
                this.syncUI();
                window.addEventListener('scroll', () => {
                    const nav = document.getElementById('navbar');
                    if(nav && window.scrollY > 50) nav.classList.add('scrolled');
                    else if(nav) nav.classList.remove('scrolled');
                });
                this.filterRooms();
                this.applyDynamicPricing();
                this.logAutomation("System core initialized. Multi-channel sync active.");
                setTimeout(() => this.showToast("Security Scan: 0 vulnerabilities found.", "success"), 2000);
            },
            showToast: function(msg, type = "info") {
                const container = document.getElementById('toast-container');
                const toast = document.createElement('div');
                toast.className = 'toast-item';
                toast.style.borderLeftColor = type === 'success' ? '#10b981' : (type === 'error' ? '#ef4444' : '#c5a059');
                toast.innerHTML = `
                    <div style="display:flex; gap:12px; align-items:center;">
                        <i class="fas ${type==='success'?'fa-check-circle':(type==='error'?'fa-exclamation-triangle':'fa-info-circle')}" style="color:${toast.style.borderLeftColor}"></i>
                        <div><strong style="display:block; font-size:0.7rem; opacity:0.6;">SYSTEM ALERT</strong>${msg}</div>
                    </div>
                `;
                container.appendChild(toast);
                setTimeout(() => toast.remove(), 5000);
            },
            openIotModal: function(id) {
                const room = DB.rooms.find(r => r.id === id);
                if(!room) return;
                document.getElementById('iot-guest-name').innerText = room.guestName || "Guest";
                document.getElementById('iot-room-number').innerText = room.id;
                document.getElementById('dnd-toggle').checked = room.iot?.dnd || false;
                document.getElementById('iot-modal').classList.add('active');
            },
            closeIotModal: function() { document.getElementById('iot-modal').classList.remove('active'); },
            updateIoT: function(device, val, displayId, unit) {
                const display = document.getElementById(displayId);
                if (device === 'CURTAINS') display.innerText = val == 100 ? 'Fully Opened' : (val == 0 ? 'Closed' : val + unit);
                else display.innerText = val + unit;
                this.logAutomation(`IOT_UNIT: ${device} calibrated to ${val}${unit}. Feedback loop validated.`);
            },
            setMood: function(mood) {
                this.showToast(`Mood Profile Activated: ${mood}`, "info");
                this.logAutomation(`IOT_SCENE: Hardware preset '${mood}' applied. Lighting & Media synced.`);
            },
            toggleTV: function() {
                this.showToast(`Entertainment System Toggle Triggered`, "success");
                this.logAutomation(`IOT_MEDIA: TV unit signal sent. Power state changed.`);
            },
            togglePrivacy: function(isDnd) {
                const type = isDnd ? "error" : "success";
                const msg = isDnd ? "DND Active - Room Hidden" : "Privacy Released - Staff Access OK";
                this.showToast(msg, type);
                this.logAutomation(`IOT_SECURITY: Privacy Node ${isDnd?'LOCKED':'OPENED'}. Digital signage updated.`);
            },
            requestService: function(service) {
                this.showToast(`Request Received: ${service} for Room ${document.getElementById('iot-room-number').innerText}`, "success");
                this.logAutomation(`SERVICE: Neural queue updated. Dispatching staff for ${service}.`);
            },
            startCleaning: function(id) {
                const room = DB.rooms.find(r => r.id === id);
                if(!room) return;
                let progress = 0;
                this.showToast(`Autonomous Housekeeping started for Unit ${id}`, "info");
                const interval = setInterval(() => {
                    progress += 10;
                    this.logAutomation(`CLEANING UNIT ${id}: ${progress}% COMPLETED...`);
                    if(progress >= 100) {
                        clearInterval(interval);
                        this.updateSuppliesAfterCleaning(id);
                        this.showToast(`Unit ${id} is now pristine and ready.`, "success");
                    }
                }, 400); 
            },
            executeAI: function() {
                Swal.fire({
                    title: 'Executing Neural Logic',
                    html: 'AI is analyzing 1,402 market variables...',
                    timer: 2500,
                    timerProgressBar: true,
                    didOpen: () => { Swal.showLoading(); },
                }).then(() => {
                    this.showToast("Scenario Optimized: High-Yield Mode Active", "success");
                    this.logAutomation("AI_REASONING: Applied Peak Season logic. Yield curve normalized.");
                });
            },
            loadState: function() {
                const saved = localStorage.getItem('IP_HOT_PROF_EN_V1');
                if (saved) {
                    DB = JSON.parse(saved);
                    if (!DB.crm) DB.crm = [...DEFAULT_STATE.crm];
                } else { 
                    DB = JSON.parse(JSON.stringify(DEFAULT_STATE)); 
                    this.saveState(); 
                }
            },
            saveState: function() { localStorage.setItem('IP_HOT_PROF_EN_V1', JSON.stringify(DB)); },
            resetSystem: function() {
                Swal.fire({ title: 'System Reset?', text: "Factory reset will wipe all revenue and logs.", icon: 'warning', showCancelButton: true, confirmButtonColor: '#c5a059', confirmButtonText: 'Execute Wipe' })
                .then((result) => { if (result.isConfirmed) { localStorage.removeItem('IP_HOT_PROF_EN_V1'); location.reload(); } });
            },
            openAdminGate: function() { document.getElementById('admin-pin-gate').classList.add('active'); },
            closeAdminGate: function() { document.getElementById('admin-pin-gate').classList.remove('active'); },
            pinFocus: function(el, next) { if(el.value && next < 3) {
                const digits = document.querySelectorAll('.pin-digit');
                if(digits[next+1]) digits[next+1].focus();
            } },
            verifyAdmin: function() {
                let pin = ""; document.querySelectorAll('.pin-digit').forEach(d => pin += d.value);
                if(pin === "1234") { 
                    this.closeAdminGate(); this.toggleAdmin(true); this.logAutomation("Staff session authorized. AES-256 bridge established.");
                } else { Swal.fire('Security Alert', 'Unauthorized PIN Entry Detected.', 'error'); }
                document.querySelectorAll('.pin-digit').forEach(d => d.value = "");
            },
            openUserGate: function() { document.getElementById('user-login-gate').classList.add('active'); },
            closeUserGate: function() { document.getElementById('user-login-gate').classList.remove('active'); },
            verifyUser: function() { 
                const email = document.getElementById('login-email').value;
                const member = DB.crm.find(c => c.email.toLowerCase() === email.toLowerCase());
                if (member) {
                    DB.currentUser = member;
                    this.saveState();
                    this.closeUserGate();
                    this.renderNavbar();
                    this.showToast(`REAL-TIME: Welcome back, ${member.name}. Mobile Key Active.`, "success");
                } else {
                    DB.currentUser = { name: "Guest User", tier: "GUEST" };
                    this.saveState();
                    this.closeUserGate();
                    this.renderNavbar();
                    Swal.fire('Welcome', 'Imperial Guest Dashboard Active', 'success');
                }
            },
            logout: function() {
                DB.currentUser = null;
                this.saveState();
                this.renderNavbar();
                Swal.fire('Logged Out', 'You have been safely disconnected.', 'info');
            },
            renderNavbar: function() {
                const container = document.getElementById('nav-actions-container');
                if (!container) return;
                if (DB.currentUser) {
                    container.innerHTML = `
                        <div class="user-profile-badge" onclick="app.showUserSettings()">
                            <div class="user-avatar">${DB.currentUser.name[0]}</div>
                            <span>${DB.currentUser.name}</span>
                        </div>
                        <button class="btn-login-user" onclick="app.logout()" style="background: var(--accent-red); border:none">Logout</button>
                        <button class="btn-portal" onclick="app.openAdminGate()">Staff Terminal</button>
                    `;
                } else {
                    container.innerHTML = `
                        <button class="btn-login-user" onclick="app.openUserGate()">Guest Login</button>
                        <button class="btn-portal" onclick="app.openAdminGate()">Staff Terminal</button>
                    `;
                }
            },
            showUserSettings: function() {
                Swal.fire({
                    title: DB.currentUser.name,
                    html: `Tier: ${DB.currentUser.tier}<br>Loyalty Status: ACTIVE<br><br><small>Exclusive member benefits are applied automatically at checkout.</small>`,
                    icon: 'info',
                    confirmButtonColor: '#c5a059'
                });
            },
            applyDynamicPricing: function() {
                const multiplier = DB.engine.pricing ? (1 + (DB.engine.pricingSens / 200)) : 1;
                DB.rooms.forEach(r => {
                    r.price = Math.round(r.basePrice * multiplier);
                });
                this.renderRooms();
            },
            validateAndConfirm: function() {
                const email = document.getElementById('cust-email');
                const card = document.getElementById('pay-card');
                const cvc = document.getElementById('pay-cvc');
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                let errors = [];
                if(!emailRegex.test(email.value)) { errors.push("Invalid Electronic Mail format"); email.classList.add('invalid'); }
                else email.classList.remove('invalid');
                if(card.value.length < 16 || isNaN(card.value)) { errors.push("Card number must be exactly 16 digits"); card.classList.add('invalid'); }
                else card.classList.remove('invalid');
                if(cvc.value.length < 3 || isNaN(cvc.value)) { errors.push("CVC security code must be 3 digits"); cvc.classList.add('invalid'); }
                else cvc.classList.remove('invalid');
                if(errors.length > 0) {
                    Swal.fire({ title: 'Validation Failed', html: errors.join('<br>'), icon: 'error', confirmButtonColor: '#ef4444' });
                } else {
                    this.confirmBooking();
                }
            },
            openCheckin: function() { document.getElementById('checkin-modal').classList.add('active'); },
            closeCheckin: function() { document.getElementById('checkin-modal').classList.remove('active'); },
            openCheckout: function() { document.getElementById('guest-checkout-modal').classList.add('active'); },
            closeCheckout: function() { document.getElementById('guest-checkout-modal').classList.remove('active'); },
            handleEKycPreview: function(input) {
                const previewBox = document.getElementById('ekyc-preview-box');
                const previewImg = document.getElementById('ekyc-img-preview');
                const scanLine = document.getElementById('ekyc-scan-line');
                if (input.files && input.files[0]) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        previewImg.src = e.target.result;
                        previewBox.classList.remove('hidden');
                        scanLine.style.opacity = '1';
                        app.logAutomation("E-KYC: Biometric capture ready. Analyzing facial nodes.");
                    }
                    reader.readAsDataURL(input.files[0]);
                }
            },
            executeCheckin: function() {
                const codeInput = document.getElementById('checkin-code');
                const code = codeInput.value.trim();
                const ekyc = document.getElementById('ekyc-file-checkin');
                if(!code) return Swal.fire('Error', 'Please enter your Booking ID', 'error');
                if(!ekyc.files[0]) return Swal.fire('E-KYC Failed', 'Identification image is mandatory.', 'error');
                const roomMatch = DB.rooms.find(r => r.bookingId === code);
                if(!roomMatch) {
                    return Swal.fire({
                        title: 'Invalid Authentication Code',
                        text: 'No matching reservation found in the live neural database. Please use the unique ID generated during your stay request.',
                        icon: 'error',
                        confirmButtonColor: '#ef4444'
                    });
                }
                const overlay = document.getElementById('proc-overlay');
                overlay.style.display = 'flex';
                document.getElementById('tx-id').innerText = "KYC_VERIF_CORE: " + code;
                const verifiedName = roomMatch.guestName; 
                const roomId = roomMatch.id;
                const steps = [
                    { time: 800, text: "Scanning ID Biometric Points...", active: 1 },
                    { time: 1600, text: "OCR Extraction: Identity Found.", active: 2 },
                    { time: 2400, text: "Authenticating Stay Metadata...", active: 3 },
                    { time: 3200, text: "Generating Digital Mobile Key...", active: 4 }
                ];
                steps.forEach(s => setTimeout(() => {
                    document.getElementById('proc-status-text').innerText = s.text;
                    document.getElementById('step-'+s.active).classList.add('done');
                }, s.time));
                setTimeout(() => {
                    overlay.style.display = 'none';
                    this.closeCheckin();
                    this.showToast(`Key Activated for Unit ${roomId}`, "success");
                    Swal.fire({
                        title: 'Check-in Complete',
                        html: `<b>Identity Verified: ${verifiedName}</b><br>Assigned Unit: <b>${roomId}</b><br><br>Welcome to Imperial Palace. Your Digital Key has been successfully synced to your session.`,
                        icon: 'success',
                        confirmButtonColor: '#c5a059'
                    });
                    document.querySelectorAll('.step-circle').forEach(c => c.classList.remove('active', 'done'));
                }, 4000);
            },
            executeGuestCheckout: function() {
                const code = document.getElementById('checkout-code-guest').value.trim();
                if(!code) return Swal.fire('Error', 'Please enter your Booking ID', 'error');
                const room = DB.rooms.find(r => r.bookingId === code);
                if(!room) return Swal.fire('Invalid Code', 'No active booking found with this ID.', 'error');
                const guestName = room.guestName;
                const roomId = room.id;
                this.closeCheckout();
                this.checkoutRoom(roomId); 
                this.showToast(`Check-out success: Thank you, ${guestName}!`, "success");
                Swal.fire('Session Terminated', `Unit ${roomId} has been released. Safe travels!`, 'success');
                document.getElementById('checkout-code-guest').value = "";
            },
            checkoutRoom: function(id) {
                const room = DB.rooms.find(r => r.id === id);
                if(room) {
                    room.status = "Needs Cleaning";
                    room.house = "Dirty"; 
                    room.guestName = null;
                    room.bookingId = null;
                    this.logAutomation(`GUEST_OUT: Unit ${id} flagged as DIRTY. Scheduled for sanitization.`);
                    this.saveState();
                    this.syncUI();
                }
            },
            updateSuppliesAfterCleaning: function(id) {
                const room = DB.rooms.find(r => r.id === id);
                if(!room || room.house !== "Dirty") return;
                const supplyItems = ["Sandalwood Soap Bars", "Bamboo Toothbrushes"];
                supplyItems.forEach(itemName => {
                    const item = DB.supplies.find(s => s.name === itemName);
                    if(item && item.stock > 0) {
                        item.stock -= 1;
                        if(item.stock < item.min) {
                            this.showToast(`Low Stock Alert: ${itemName}`, "error");
                            DB.logs.unshift({ time: new Date().toLocaleTimeString(), msg: `LOW_STOCK: ${itemName} below threshold.` });
                        }
                    }
                });
                room.house = "Clean";
                room.status = "available";
                this.saveState();
                this.syncUI();
            },
            logAutomation: function(msg) {
                const log = document.getElementById('automation-log');
                if(log) { log.innerText = `SYS_COMMAND: ${msg}`; log.classList.add('active'); setTimeout(() => log.classList.remove('active'), 4000); }
            },
            setupDates: function() {
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('search-checkin').value = today;
                document.getElementById('search-checkout').value = new Date(new Date().setDate(new Date().getDate() + 1)).toISOString().split('T')[0];
            },
            syncUI: function() {
                this.renderNavbar();
                this.renderRooms();
                if(!document.getElementById('admin-interface').classList.contains('hidden')) { this.renderAdminTab(); }
            },
            handleImgError: function(img, id) {
                img.onerror = null; 
                img.src = `https://images.unsplash.com/photo-1542314831-068cd1dbfeeb?q=80&w=800`;
            },
            renderRooms: function(filterType = 'all') {
                const grid = document.getElementById('room-grid');
                if(!grid) return;
                grid.innerHTML = '';
                const roomTypeCounts = {};
                DB.rooms.forEach(r => {
                    if(r.status === 'available') roomTypeCounts[r.type] = (roomTypeCounts[r.type] || 0) + 1;
                });
                let bufferCounters = { Deluxe: 0, Suite: 0, Villa: 0 };
                let totalBuffer = 0;
                DB.rooms.forEach(room => {
                    if (filterType !== 'all' && room.type !== filterType) return;
                    let isBuffer = false;
                    if(room.status === 'available') {
                        bufferCounters[room.type]++;
                        if(bufferCounters[room.type] > Math.max(0, roomTypeCounts[room.type] - 2)) {
                            isBuffer = true;
                            totalBuffer++;
                        }
                    }
                    const statusClass = room.status === 'Needs Cleaning' ? 'bg-cleaning' : (room.status === 'booked' ? 'bg-booked' : 'bg-avail');
                    const statusText = isBuffer ? 'SYSTEM BUFFER' : (room.status === 'Needs Cleaning' ? 'CLEANING REQ' : room.status.toUpperCase());
                    const iotBtn = (room.status === 'booked') ? `<button class="btn-book" onclick="app.openIotModal(${room.id})" style="background:var(--primary-gold); color:white; margin-top:10px; border:none"><i class="fas fa-home"></i> MY SMART ROOM</button>` : '';
                    grid.innerHTML += `
                        <div class="room-card ${isBuffer ? 'buffer-locked' : ''}">
                            <div class="room-img-box">
                                <img src="${room.img}" class="room-img" loading="lazy" onerror="app.handleImgError(this, ${room.id})">
                                <span class="status-badge ${isBuffer ? 'bg-maint' : statusClass}">
                                    ${statusText}
                                </span>
                                <div class="price-badge">$${room.price}</div>
                            </div>
                            <div class="room-details">
                                <div class="room-type">${room.type} COLLECTION</div>
                                <h3 class="room-title">${room.name} #${room.id}</h3>
                                <div class="room-amenities"><span><i class="fas fa-wifi"></i> Ultra-GDS</span><span><i class="fas fa-gem"></i> Premium</span></div>
                                <button class="btn-book" ${room.status !== 'available' || isBuffer ? 'disabled' : ''} onclick="app.openBooking(${room.id})">
                                    ${isBuffer ? 'LOCKED BY BUFFER' : (room.status !== 'available' ? 'NOT AVAILABLE' : 'AUTHORIZE STAY')}
                                </button>
                                ${iotBtn}
                            </div>
                        </div>`;
                });
                DB.bufferHoldCount = totalBuffer;
            },
            filterRooms: function() { this.renderRooms(document.getElementById('search-type')?.value || 'all'); },
            openBooking: function(id) {
                const room = DB.rooms.find(r => r.id === id);
                document.getElementById('modal-room-id').value = id;
                document.getElementById('bill-room-name').innerText = room.name;
                document.getElementById('bill-nights').innerText = 3;
                const totalStay = (3 * room.price);
                const depositValue = Math.round(totalStay * 0.3);
                document.getElementById('bill-deposit-amt').innerText = '$' + depositValue.toLocaleString();
                document.getElementById('bill-total').innerText = '$' + totalStay.toLocaleString();
                if(DB.currentUser && DB.currentUser.name !== "Guest User") {
                    document.getElementById('cust-name').value = DB.currentUser.name;
                    document.getElementById('cust-email').value = DB.currentUser.email || "";
                    document.getElementById('cust-phone').value = DB.currentUser.phone || "";
                }
                document.getElementById('booking-modal').classList.add('active');
            },
            closeModal: function() { document.getElementById('booking-modal').classList.remove('active'); },
            confirmBooking: function() {
                const id = parseInt(document.getElementById('modal-room-id').value);
                const guestName = document.getElementById('cust-name').value;
                const guestEmail = document.getElementById('cust-email').value;
                const guestPhone = document.getElementById('cust-phone').value;
                this.closeModal();
                const overlay = document.getElementById('proc-overlay');
                overlay.style.display = 'flex';
                const bookingId = "IP-" + Math.random().toString(36).substr(2, 5).toUpperCase();
                document.getElementById('tx-id').innerText = "SECURE_TX: INITIALIZING...";
                const steps = [
                    { time: 800, text: "GDS API Node Authentication...", active: 1 },
                    { time: 1600, text: "Checking for Concurrent Node Requests...", active: 2 },
                    { time: 2400, text: "Neural Mapping: CRM Entry Initialization...", active: 3 },
                    { time: 3200, text: "Confirming Reservation #" + bookingId, active: 4 }
                ];
                const conflictDetected = Math.random() < 0.1;
                steps.forEach(s => setTimeout(() => {
                    document.getElementById('proc-status-text').innerText = s.text;
                    document.getElementById('step-'+s.active).classList.add('done');
                    if(s.active < 4) document.getElementById('step-'+(s.active+1)).classList.add('active');
                }, s.time));
                setTimeout(() => {
                    overlay.style.display = 'none';
                    const room = DB.rooms.find(r => r.id === id);
                    room.status = 'booked';
                    room.guestName = guestName;
                    room.bookingId = bookingId;
                    const stayValue = room.price * 3;
                    const depositVal = Math.round(stayValue * 0.3);
                    DB.totalRevenue += depositVal;
                    let existingGuest = DB.crm.find(c => c.email.toLowerCase() === guestEmail.toLowerCase());
                    if(!existingGuest) {
                        DB.crm.unshift({
                            name: guestName, email: guestEmail, phone: guestPhone, tier: "GUEST", spend: stayValue, last: "Today", prefs: "Direct booking resident", points: Math.round(stayValue * 0.1), stays: 1, health: 100
                        });
                    } else {
                        existingGuest.spend += stayValue; existingGuest.stays += 1; existingGuest.last = "Today"; existingGuest.points += Math.round(stayValue * 0.1);
                        if(existingGuest.spend > 100000) existingGuest.tier = "PLATINUM";
                        else if(existingGuest.spend > 50000) existingGuest.tier = "GOLD";
                    }
                    DB.logs.unshift({ time: new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'}), msg: `DEPOSIT_PAID: ${bookingId} (+$${depositVal}) by ${guestName}` });
                    this.saveState(); this.syncUI();
                    const notifyName = DB.currentUser ? DB.currentUser.name : guestName;
                    this.showToast(`REAL-TIME: ${notifyName}, your booking ${bookingId} is secured!`, "success");
                    Swal.fire({ 
                        title: conflictDetected ? 'Conflict Resolved' : 'Booking Successful', 
                        html: `<b>Congratulations, ${guestName}!</b><br>Your booking code is: <b style="color: var(--primary-gold); font-size: 1.2rem;">${bookingId}</b><br>Please save this code for your check-in.`, 
                        icon: 'success', confirmButtonColor: '#c5a059' 
                    });
                    document.querySelectorAll('.step-circle').forEach(c => c.classList.remove('active', 'done'));
                }, 4000);
            },
            currentAdminTab: 'overview',
            switchAdminTab: function(tab, el) {
                this.currentAdminTab = tab;
                document.querySelectorAll('.menu-item').forEach(m => m.classList.remove('active'));
                el.classList.add('active'); this.renderAdminTab();
            },
            renderAdminTab: function() {
                const main = document.getElementById('admin-main-content');
                if(!main) return;
                switch(this.currentAdminTab) {
                    case 'overview': main.innerHTML = this.getOverviewHTML(); break;
                    case 'matrix': main.innerHTML = this.getMatrixHTML(); break;
                    case 'engine': main.innerHTML = this.getEngineHTML(); break;
                    case 'crm': main.innerHTML = this.getCRMHTML(); break;
                    case 'supplies': main.innerHTML = this.getSuppliesHTML(); break;
                }
                if(this.currentAdminTab === 'overview') this.initRevenueChart();
            },
            initRevenueChart: function() {
                const ctx = document.getElementById('revenueChart')?.getContext('2d');
                if(!ctx) return;
                const baseVal = DB.totalRevenue;
                new Chart(ctx, { 
                    type: 'line', 
                    data: { 
                        labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'], 
                        datasets: [
                        { label: 'Yield Performance ($)', data: [baseVal-80000, baseVal-60000, baseVal-45000, baseVal-30000, baseVal-15000, baseVal-5000, baseVal], borderColor: '#c5a059', backgroundColor: 'rgba(197, 160, 89, 0.1)', fill: true, tension: 0.4 },
                        { label: 'AI Forecast (Predictive)', data: [baseVal, baseVal+12000, baseVal+25000, baseVal+40000, baseVal+60000, baseVal+85000, baseVal+120000], borderColor: '#10b981', borderDash: [5, 5], fill: false, tension: 0.4 }
                        ] 
                    },
                    options: { responsive: true, plugins: { legend: { display: true, labels: { color: '#94a3b8' } } }, scales: { y: { grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#94a3b8' } }, x: { ticks: { color: '#94a3b8' } } } }
                });
            },
            getOverviewHTML: function() {
                const booked = DB.rooms.filter(r => r.status === 'booked').length;
                return `
                    <div class="admin-header"><h2>Executive Overview</h2><button class="btn-portal" onclick="app.executeAI()"><i class="fas fa-bolt"></i> OPTIMIZE YIELD</button></div>
                    <div class="stats-grid">
                        <div class="stat-box"><span class="label">Gross Revenue</span><div class="value">$${DB.totalRevenue.toLocaleString()}</div></div>
                        <div class="stat-box"><span class="label">ADR (Avg Daily Rate)</span><div class="value">$${Math.round(DB.totalRevenue/(booked||1)).toLocaleString()}</div></div>
                        <div class="stat-box"><span class="label">Occupancy Rate</span><div class="value">${Math.round((booked/DB.rooms.length)*100)}%</div></div>
                        <div class="stat-box"><span class="label">AI Yield Index</span><div class="value">9.8/10</div></div>
                    </div>
                    <div class="matrix-container" style="border-top: 4px solid var(--primary-gold);">
                        <h4 style="margin-bottom: 20px;"><i class="fas fa-chart-line"></i> Performance Analytics & AI Forecasting</h4>
                        <canvas id="revenueChart" height="100"></canvas>
                    </div>`;
            },
            getMatrixHTML: function() {
                return `
                    <div class="admin-header">
                        <div>
                            <h2>Inventory Allocation Matrix</h2>
                            <p style="font-size:0.8rem; color: var(--text-gray);">Mapping across 14 channels. Node locking protocol active.</p>
                        </div>
                    </div>
                    <div class="matrix-container">
                        <table class="matrix-table">
                            <thead>
                                <tr>
                                    <th style="text-align:left; width: 220px;">Node Identifier</th>
                                    <th>Ops Status</th>
                                    <th>Channel Source</th>
                                    <th>Parity Price</th>
                                    <th>Action Control</th>
                                    <th>Guest / Resident</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${DB.rooms.map((r, i) => {
                                    let channelHTML = i%3===0 ? '<span style="color:#003580; font-weight:700;"><i class="fas fa-bold"></i> Booking.com</span>' : (i%2===0 ? '<span style="color:#e21a2c; font-weight:700;"><i class="fas fa-h-square"></i> Agoda</span>' : '<span style="color:#001e32; font-weight:700;"><i class="fas fa-globe"></i> Expedia</span>');
                                    let actionBtn = r.status === 'booked' ? `<button onclick="app.checkoutRoom(${r.id})" style="background:#ef4444; color:white; border:none; padding:5px 10px; border-radius:4px; font-size:0.6rem;">CHECK-OUT</button>` : (r.status === 'Needs Cleaning' ? `<button onclick="app.startCleaning(${r.id})" style="background:#f59e0b; color:white; border:none; padding:5px 10px; border-radius:4px; font-size:0.6rem;">START CLEANING</button>` : `<span style="color:#10b981; font-size:0.6rem; font-weight:700;">READY</span>`);
                                    const guestDisplay = r.status === 'booked' ? `Resident: ${r.guestName || 'GUEST'} <br><small style="color:var(--text-gray)">ID: ${r.bookingId || 'N/A'}</small>` : 'OPEN';
                                    return `
                                    <tr>
                                        <td style="text-align:left">
                                            <div style="display:flex; align-items:center; gap:10px;">
                                                <div style="width:5px; height:30px; background:${r.type==='Deluxe'?'#3b82f6':(r.type==='Suite'?'#c5a059':'#ef4444')}; border-radius:10px;"></div>
                                                <div><strong>${r.name}</strong><br><small style="color:var(--text-gray)">UID: ${r.id}</small></div>
                                            </div>
                                        </td>
                                        <td><span style="font-size:0.65rem; color:${r.house==='Clean'?'#10b981':(r.house==='Dirty'?'#ef4444':'#3b82f6')}; font-weight:700;"><i class="fas fa-soap"></i> ${r.house.toUpperCase()}</span></td>
                                        <td><span style="font-size:0.65rem;">${channelHTML}</span></td>
                                        <td><small style="color:var(--primary-gold)">$${r.price}</small></td>
                                        <td>${actionBtn}</td>
                                        <td><div class="status-slot ${r.status==='booked'?'slot-booked':'slot-open'}">${guestDisplay}</div></td>
                                    </tr>`;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>`;
            },
            updateEngineParam: function(key, val) {
                DB.engine[key] = parseInt(val);
                this.applyDynamicPricing(); this.renderAdminTab(); this.saveState();
                this.logAutomation(`Neural Param: ${key} recalibrated to ${val}`);
            },
            getEngineHTML: function() {
                const s = [
                    { k: 'pricingSens', l: 'Dynamic Yield Engine', d: 'Surge pricing logic based on global demand sensors.', val: DB.engine.pricingSens, unit: '% Sens' },
                    { k: 'predictiveSens', l: 'Predictive Maintenance', d: 'Hardware telemetry for pre-emptive repair cycles.', val: DB.engine.predictiveSens || 75, unit: '% Acc' },
                    { k: 'conciergeLogic', l: 'Neural Concierge Logic', d: 'AI automated guest request routing and queuing.', val: DB.engine.conciergeLogic || 90, unit: ' IQ' },
                    { k: 'ecoTemp', l: 'Neural HVAC Automation', d: 'Centralized energy management via hardware nodes.', val: DB.engine.ecoTemp, unit: '°C Limit' }
                ];
                return `
                    <div class="admin-header"><h2>Automation & Neural Heuristics</h2></div>
                    <div class="automation-grid">
                        ${s.map(i => `
                            <div class="engine-card">
                                <div class="engine-top">
                                    <div style="display:flex; gap:15px; align-items:center;">
                                        <div style="color:var(--primary-gold); font-size:1.6rem; background:rgba(197, 160, 89, 0.1); width:50px; height:50px; border-radius:12px; display:flex; align-items:center; justify-content:center; border:1px solid rgba(197, 160, 89, 0.2);"><i class="fas fa-brain"></i></div>
                                        <div><h4>${i.l}</h4><p style="font-size:0.7rem; color:#94a3b8;">${i.d}</p></div>
                                    </div>
                                    <label class="switch"><input type="checkbox" checked><span class="slider"></span></label>
                                </div>
                                <div class="engine-config">
                                    <div class="config-row"><span>Intensity Sensor</span><span class="config-val">${i.val}${i.unit}</span></div>
                                    <input type="range" class="engine-slider" min="0" max="150" value="${i.val}" oninput="app.updateEngineParam('${i.k}', this.value)">
                                </div>
                            </div>`).join('')}
                    </div>
                    <div class="matrix-container" style="margin-top:30px; border-left:4px solid var(--cyber-green);">
                        <h4 style="margin-bottom:15px; font-family:'Fira Code'"><i class="fas fa-terminal"></i> NEURAL REASONING TRACE [v4.2]</h4>
                        <div style="font-family:'Fira Code', monospace; font-size:0.75rem; color:var(--cyber-green); line-height:1.8; height: 350px; overflow-y: auto; background: #000; padding: 25px; border-radius: 12px; box-shadow: inset 0 0 15px rgba(0,255,65,0.1);">
                            <div style="color: white; opacity: 0.5;">[${new Date().toLocaleTimeString()}] > INITIALIZING SECURITY SCAN...</div>
                            <div style="color: #fff">[OK] 256-BIT ENCRYPTION HANDSHAKE SUCCESSFUL.</div>
                            <div>[SYSTEM] Neural Matrix Online. 14,021 threads active.</div>
                            <div>[ANALYZING] Scanned 14 channel nodes (Expedia, Agoda, Booking). Sync status: 100%.</div>
                            <div>[HEURISTIC] Demand sensors detect 15% spike in Region-A hospitality index.</div>
                            <div>[IOT_WATCH] Unit 105 humidity sensors report 65%. Activating HVAC Node 4-Alpha.</div>
                            <div>[IOT_WATCH] Unit 202 occupancy detected via infrared node. Cross-referencing check-in... Verified.</div>
                            <div>[SENTIMENT] Guest preference extracted: "High floor", "Late checkout prospect".</div>
                            <div>[SECURITY] RSA-4096 handshake successful with Global GDS Gateway.</div>
                            <div>[CLEANING_SCHEDULER] Dispatching autonomous drone unit to Floor 2 for Unit 104.</div>
                            <div>[YIELD] Predictive revenue delta: +$1,250.00 since last audit cycle.</div>
                            <div style="border-top: 1px solid rgba(0,255,65,0.2); margin-top:10px; padding-top:10px;">[LISTENING] Ready for neural inputs... _</div>
                        </div>
                    </div>`;
            },
            getCRMHTML: function() {
                return `
                    <div class="admin-header"><h2>Guest Insights & Loyalty Matrix</h2></div>
                    <div class="matrix-container">
                        <table class="matrix-table">
                            <thead>
                                <tr><th style="text-align:left">Elite Member Profile</th><th>Tier Status</th><th>Stays</th><th>Total Spend</th><th>Points</th><th>Sentiment</th><th>Preferences</th></tr>
                            </thead>
                            <tbody>
                                ${DB.crm.map(c => `
                                    <tr>
                                        <td style="text-align:left"><div style="display:flex; align-items:center; gap:12px;"><div style="width:40px; height:40px; background:var(--primary-dark); border-radius:50%; display:flex; align-items:center; justify-content:center; border:1px solid var(--primary-gold); color:var(--primary-gold);">${c.name[0]}</div><div><strong>${c.name}</strong><br><small style="color:var(--text-gray)">${c.last}</small></div></div></td>
                                        <td><span style="border:1px solid var(--primary-gold); padding:4px 12px; border-radius:20px; font-size:0.65rem; font-weight:700; color:var(--primary-gold);">${c.tier}</span></td>
                                        <td><strong style="color:white">${c.stays}</strong></td>
                                        <td><strong style="color:var(--accent-green)">$${c.spend.toLocaleString()}</strong></td>
                                        <td>${(c.points || 0).toLocaleString()}</td>
                                        <td><div style="display:flex; align-items:center; gap:8px;"><div style="width:50px; height:6px; background:#1f2937; border-radius:3px;"><div style="width:${c.health || 80}%; height:100%; background:#10b981; border-radius:3px;"></div></div><small>${c.health || 80}%</small></div></td>
                                        <td><span style="font-size:0.6rem; font-style:italic;">"${c.prefs || 'N/A'}"</span></td>
                                    </tr>`).join('')}
                            </tbody>
                        </table>
                    </div>`;
            },
            getSuppliesHTML: function() {
                return `
                    <div class="admin-header"><h2>Supply Chain & Resource Inventory</h2></div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                        ${DB.supplies.map(s => {
                            const percent = Math.min((s.stock / (s.min * 2)) * 100, 100);
                            return `
                                <div class="supply-card">
                                    <div style="width: 100%">
                                        <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                                            <div class="supply-info"><div class="supply-icon"><i class="fas ${s.cat==='Minibar'?'fa-glass-martini-alt':(s.cat==='F&B'?'fa-coffee':'fa-pump-soap')}"></i></div><div><h4 style="color:white">${s.name}</h4><small style="color:var(--text-gray)">${s.cat}</small></div></div>
                                            <span class="supply-status ${s.stock < s.min?'status-low':'status-ok'}">${s.stock < s.min?'REORDER':'OK'}</span>
                                        </div>
                                        <div class="supply-stock-bar"><div class="supply-stock-fill" style="width: ${percent}%;"></div></div>
                                    </div>
                                </div>`;
                        }).join('')}
                    </div>`;
            },
            toggleAdmin: function(show) {
                document.getElementById('admin-interface').classList.toggle('hidden', !show);
                document.getElementById('client-app').classList.toggle('hidden', show);
                if(show) { this.currentAdminTab = 'overview'; this.renderAdminTab(); }
            }
        };
        document.addEventListener('DOMContentLoaded', () => app.init());
    </script>
</body>
</html>